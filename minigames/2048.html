<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>2048</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{font-family:system-ui,Arial,sans-serif;background:#f6f0ff;margin:0;display:flex;flex-direction:column;align-items:center;padding:20px;color:#4b3b6e}
h1{margin:10px 0;font-size:48px;font-weight:700}
#game-wrapper{max-width:420px;width:100%}
.top-bar{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
.box{background:#6d28d9;color:#fff;padding:10px 15px;border-radius:6px;text-align:center;min-width:90px}
.box .label{font-size:12px;text-transform:uppercase;letter-spacing:1px}
button{background:#7c3aed;color:#fff;border:none;padding:10px 18px;border-radius:6px;font-size:14px;cursor:pointer}
button:hover{background:#6d28d9}
#grid{position:relative;background:#5b21b6;border-radius:6px;padding:10px;display:grid;grid-template-columns:repeat(4,1fr);gap:10px;width:100%;box-sizing:border-box}
.cell{background:#e9ddff;border-radius:4px;position:relative;height:90px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:32px;transition:all .12s;color:#4b3b6e}
@media (max-width:480px){.cell{height:70px;font-size:26px}}
.tile-2{background:#f2ecff;color:#4b3b6e}
.tile-4{background:#e5d9ff;color:#4b3b6e}
.tile-8{background:#cbb8ff;color:#f9f6f2}
.tile-16{background:#b79aff;color:#f9f6f2}
.tile-32{background:#a27cfb;color:#f9f6f2}
.tile-64{background:#8b5cf6;color:#f9f6f2}
.tile-128{background:#7c3aed;color:#f9f6f2;font-size:26px}
.tile-256{background:#6d28d9;color:#f9f6f2;font-size:26px}
.tile-512{background:#5b21b6;color:#f9f6f2;font-size:26px}
.tile-1024{background:#4c1d95;color:#f9f6f2;font-size:20px}
.tile-2048{background:#2e1065;color:#f9f6f2;font-size:20px}
.dim{opacity:.3}
#message{margin:12px 0;font-weight:600;min-height:24px}
.instructions{font-size:13px;line-height:1.4;margin-top:16px;background:#f3eaff;padding:10px 12px;border-radius:6px}
a{color:#7c3aed;text-decoration:none}
</style>
</head>
<body>
<h1>2048</h1>
<div id="game-wrapper">
  <div class="top-bar">
    <div class="box">
      <div class="label">Score</div>
      <div id="score">0</div>
    </div>
    <div class="box">
      <div class="label">Best</div>
      <div id="best">0</div>
    </div>
    <button id="restart" aria-label="Restart game">Restart</button>
  </div>
  <div id="message" role="status" aria-live="polite"></div>
  <div id="grid" aria-label="2048 game board"></div>
  <div class="instructions">
    Combine tiles to reach 2048. Use Arrow Keys / WASD (swipe on touch). Highest tile strategy: pick a corner and feed it.
  </div>
</div>
<script>
(function(){
  const size=4;
  let board,score=0,best=Number(localStorage.getItem('best2048')||0),won=false,gameOver=false;
  const gridEl=document.getElementById('grid');
  const scoreEl=document.getElementById('score');
  const bestEl=document.getElementById('best');
  const msgEl=document.getElementById('message');
  bestEl.textContent=best;
  function initGrid(){
    gridEl.innerHTML='';
    for(let i=0;i<size*size;i++){
      const d=document.createElement('div');
      d.className='cell';
      d.setAttribute('data-pos',i);
      gridEl.appendChild(d);
    }
  }
  function emptyCells(){
    const cells=[];
    for(let r=0;r<size;r++)for(let c=0;c<size;c++)if(!board[r][c])cells.push([r,c]);
    return cells;
  }
  function addRandomTile(){
    const empties=emptyCells();
    if(!empties.length) return;
    const [r,c]=empties[Math.floor(Math.random()*empties.length)];
    board[r][c]=Math.random()<0.9?2:4;
  }
  function setup(){
    board=[...Array(size)].map(()=>Array(size).fill(0));
    score=0;won=false;gameOver=false;
    addRandomTile();addRandomTile();
    updateView();
    setMessage('');
  }
  function setMessage(t){msgEl.textContent=t;}
  function updateView(){
    scoreEl.textContent=score;
    if(score>best){best=score;bestEl.textContent=best;localStorage.setItem('best2048',best);}
    [...gridEl.children].forEach(cell=>{
      const pos=+cell.getAttribute('data-pos');
      const r=Math.floor(pos/size),c=pos%size;
      const val=board[r][c];
      cell.className='cell'+(val?(' tile-'+val):'');
      cell.textContent=val?val:'';
    });
    gridEl.classList.toggle('dim',gameOver||won);
  }
  function move(dir){
    if(won||gameOver) return;
    let moved=false;
    const delta={
      left:{dr:0,dc:-1,loopOuter:(r)=>r,loopInner:()=>[1,2,3],iterateRows:()=>[0,1,2,3]},
      right:{dr:0,dc:1,loopOuter:(r)=>r,loopInner:()=>[2,1,0],iterateRows:()=>[0,1,2,3]},
      up:{dr:-1,dc:0,loopOuter:(c)=>c,loopInner:()=>[1,2,3],iterateCols:()=>[0,1,2,3]},
      down:{dr:1,dc:0,loopOuter:(c)=>c,loopInner:()=>[2,1,0],iterateCols:()=>[0,1,2,3]}
    }[dir];
    if(!delta) return;
    const merged=[...Array(size)].map(()=>Array(size).fill(false));
    function traverse(){
      if(dir==='left' || dir==='right'){
        for(const r of delta.iterateRows()){
          const range=dir==='left'?[1,2,3]:[2,1,0];
          const order=delta.loopInner();
          for(const c of order){
            if(!board[r][c]) continue;
            let nc=c;
            while(true){
              const nextC=nc+ (dir==='left'?-1:1);
              if(nextC<0||nextC>=size) break;
              if(!board[r][nextC]){
                board[r][nextC]=board[r][nc];board[r][nc]=0;nc=nextC;moved=true;
              }else if(board[r][nextC]===board[r][nc] && !merged[r][nextC]){
                board[r][nextC]*=2;score+=board[r][nextC];board[r][nc]=0;merged[r][nextC]=true;moved=true;
                if(board[r][nextC]===2048 && !won){won=true;setMessage('You reached 2048! Continue if you like.');}
                break;
              }else break;
            }
          }
        }
      } else {
        for(const c of delta.iterateCols()){
          const order=dir==='up'?[1,2,3]:[2,1,0];
          for(const r of order){
            if(!board[r][c]) continue;
            let nr=r;
            while(true){
              const nextR=nr+(dir==='up'?-1:1);
              if(nextR<0||nextR>=size) break;
              if(!board[nextR][c]){
                board[nextR][c]=board[nr][c];board[nr][c]=0;nr=nextR;moved=true;
              }else if(board[nextR][c]===board[nr][c] && !merged[nextR][c]){
                board[nextR][c]*=2;score+=board[nextR][c];board[nr][c]=0;merged[nextR][c]=true;moved=true;
                if(board[nextR][c]===2048 && !won){won=true;setMessage('You reached 2048! Continue if you like.');}
                break;
              }else break;
            }
          }
        }
      }
    }
    traverse();
    if(moved){addRandomTile();updateView();checkGameOver();}
  }
  function checkGameOver(){
    if(emptyCells().length) return;
    for(let r=0;r<size;r++){
      for(let c=0;c<size;c++){
        const v=board[r][c];
        if((r+1<size && board[r+1][c]===v) || (c+1<size && board[r][c+1]===v)) return;
      }
    }
    gameOver=true;
    setMessage('Game Over. Try again!');
    updateView();
  }
  function handleKey(e){
    const k=e.key.toLowerCase();
    if(['arrowleft','a'].includes(k)) move('left');
    else if(['arrowright','d'].includes(k)) move('right');
    else if(['arrowup','w'].includes(k)) move('up');
    else if(['arrowdown','s'].includes(k)) move('down');
  }
  let touchStart=null;
  function handleTouchStart(e){
    if(e.touches.length===1) touchStart=[e.touches[0].clientX,e.touches[0].clientY];
  }
  function handleTouchEnd(e){
    if(!touchStart) return;
    const [sx,sy]=touchStart;
    const dx=e.changedTouches[0].clientX - sx;
    const dy=e.changedTouches[0].clientY - sy;
    const absX=Math.abs(dx),absY=Math.abs(dy);
    if(Math.max(absX,absY)<30) return;
    if(absX>absY) move(dx>0?'right':'left'); else move(dy>0?'down':'up');
    touchStart=null;
  }
  document.getElementById('restart').addEventListener('click',()=>{setup();});
  window.addEventListener('keydown',handleKey);
  gridEl.addEventListener('touchstart',handleTouchStart,{passive:true});
  gridEl.addEventListener('touchend',handleTouchEnd,{passive:true});
  initGrid();
  setup();
})();
</script>
</body>
</html>
