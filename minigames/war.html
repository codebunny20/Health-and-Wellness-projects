<!doctype html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width,initial-scale=1" />
	<title>War - Card Game</title>
	<style>
		:root { --bg:#0b132b; --panel:#1c2541; --accent:#5bc0be; --text:#e0e5ec; --muted:#9aa4b2; --danger:#ff6b6b; }
		* { box-sizing: border-box; }
		body {
			margin: 0; font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
			background: radial-gradient(1000px 600px at 50% -200px, #162447, var(--bg));
			color: var(--text);
			min-height: 100vh; display: grid; place-items: center;
		}
		.container { width: min(980px, 95vw); padding: 20px; }
		h1 { margin: 0 0 12px; font-size: 28px; letter-spacing: .5px; }
		.topbar { display:flex; align-items:center; justify-content:space-between; gap:16px; }
		.status { color: var(--muted); }
		.board {
			margin-top: 14px; background: var(--panel); border-radius: 12px; padding: 16px;
			box-shadow: 0 10px 30px rgba(0,0,0,.35), inset 0 0 0 1px rgba(255,255,255,.04);
		}
		.players { display:grid; grid-template-columns: 1fr auto 1fr; align-items:center; gap:12px; }
		.player { display:grid; grid-template-rows:auto auto 1fr; gap:8px; }
		.player h2 { margin:0; font-size:18px; font-weight:600; display:flex; align-items:center; gap:8px; }
		.badge { font-size:12px; color: var(--muted); background: rgba(255,255,255,.05); padding:2px 8px; border-radius:999px; }
		.counts { font-size:13px; color: var(--muted); display:flex; gap:12px; }
		.card-slot { height: 150px; display:flex; align-items:center; justify-content:center; }
		.card {
			width: 100px; height: 140px; background: #fff; border-radius: 8px; color:#111;
			display:grid; grid-template-rows:auto 1fr auto; align-items:center; justify-items:center;
			padding: 8px; position: relative;
			box-shadow: 0 8px 20px rgba(0,0,0,.4);
		}
		.card.hidden { background: linear-gradient(135deg, #2d3a6a, #1f2a4d); color: transparent; box-shadow: inset 0 0 0 2px rgba(255,255,255,.08), 0 8px 20px rgba(0,0,0,.5); }
		.card .rank { font-size: 22px; font-weight: 700; }
		.card .suit { font-size: 18px; }
		.card.red { color: #c62828; }
		.vs { display:grid; gap:8px; justify-items:center; }
		.vs .pile { font-size: 13px; color: var(--muted); }
		.controls {
			margin-top: 10px; display:flex; flex-wrap:wrap; gap:10px; align-items:center; justify-content:space-between;
		}
		.btn {
			background: var(--accent); color:#062c30; border:none; padding:10px 14px; border-radius:8px; font-weight:700; cursor:pointer;
			box-shadow: 0 6px 16px rgba(91,192,190,.35);
		}
		.btn.secondary { background: #293241; color: var(--text); box-shadow: none; }
		.btn:disabled { opacity:.6; cursor:not-allowed; }
		.inline { display:flex; gap:10px; align-items:center; }
		.slider { width: 180px; accent-color: var(--accent); }
		.message { margin-top:8px; color: var(--text); min-height: 22px; }
		.win { color: #7CFC00; font-weight:700; }
		.lose { color: var(--danger); font-weight:700; }
		.warn { color: #ffd166; font-weight:700; }
	</style>
</head>
<body>
	<div class="container">
		<div class="topbar">
			<h1>War</h1>
			<div class="status">
				Rounds: <span id="rounds">0</span>
			</div>
		</div>

		<div class="board">
			<div class="players">
				<div class="player" id="p1">
					<h2>Player 1 <span class="badge">You</span></h2>
					<div class="counts">
						<div>Deck: <span id="p1-count">26</span></div>
					</div>
					<div class="card-slot"><div class="card hidden" id="p1-card"></div></div>
				</div>

				<div class="vs">
					<div style="opacity:.8">vs</div>
					<div class="pile">Pile: <span id="pile-count">0</span></div>
					<div id="war-flag" class="badge" style="display:none;">WAR!</div>
				</div>

				<div class="player" id="p2">
					<h2>Player 2 <span class="badge">CPU</span></h2>
					<div class="counts">
						<div>Deck: <span id="p2-count">26</span></div>
					</div>
					<div class="card-slot"><div class="card hidden" id="p2-card"></div></div>
				</div>
			</div>

			<div class="controls">
				<div class="inline">
					<button id="btn-round" class="btn">Play round</button>
					<button id="btn-restart" class="btn secondary">Restart</button>
				</div>
				<div class="inline">
					<label class="inline" style="gap:6px;">
						<input type="checkbox" id="auto" />
						Auto-play
					</label>
					<input type="range" id="speed" class="slider" min="120" max="1500" step="20" value="600" />
					<span id="speed-label" class="badge">600ms</span>
				</div>
			</div>

			<div id="message" class="message"></div>
		</div>
	</div>

	<script>
		// --- Card and deck utilities ---
		const SUITS = ["♠", "♥", "♦", "♣"];
		const RANKS = [
			{ r: "2", v: 2 }, { r: "3", v: 3 }, { r: "4", v: 4 }, { r: "5", v: 5 },
			{ r: "6", v: 6 }, { r: "7", v: 7 }, { r: "8", v: 8 }, { r: "9", v: 9 },
			{ r: "10", v: 10 }, { r: "J", v: 11 }, { r: "Q", v: 12 }, { r: "K", v: 13 }, { r: "A", v: 14 }
		];

		function buildDeck() {
			const deck = [];
			for (const s of SUITS) {
				for (const { r, v } of RANKS) deck.push({ rank: r, value: v, suit: s });
			}
			return deck;
		}
		function shuffle(arr) {
			for (let i = arr.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[arr[i], arr[j]] = [arr[j], arr[i]];
			}
			return arr;
		}

		// --- State ---
		let p1 = { deck: [] };
		let p2 = { deck: [] };
		let pile = [];
		let lastP1 = null, lastP2 = null;
		let rounds = 0;
		let autoId = null;
		let gameOver = false;

		// --- DOM ---
		const el = {
			p1Card: document.getElementById("p1-card"),
			p2Card: document.getElementById("p2-card"),
			p1Count: document.getElementById("p1-count"),
			p2Count: document.getElementById("p2-count"),
			rounds: document.getElementById("rounds"),
			pile: document.getElementById("pile-count"),
			flag: document.getElementById("war-flag"),
			msg: document.getElementById("message"),
			btnRound: document.getElementById("btn-round"),
			btnRestart: document.getElementById("btn-restart"),
			auto: document.getElementById("auto"),
			speed: document.getElementById("speed"),
			speedLabel: document.getElementById("speed-label"),
		};

		// --- Rendering ---
		function renderCard(target, card) {
			if (!card) {
				target.className = "card hidden";
				target.innerHTML = "";
				return;
			}
			const red = (card.suit === "♥" || card.suit === "♦") ? " red" : "";
			target.className = "card" + red;
			target.innerHTML = `
				<div class="rank">${card.rank}</div>
				<div class="suit">${card.suit}</div>
				<div class="rank" style="opacity:.0">${card.rank}</div>
			`;
		}
		function updateUI({ flagWar = false, message = "" } = {}) {
			renderCard(el.p1Card, lastP1);
			renderCard(el.p2Card, lastP2);
			el.p1Count.textContent = p1.deck.length;
			el.p2Count.textContent = p2.deck.length;
			el.rounds.textContent = rounds;
			el.pile.textContent = pile.length;
			el.flag.style.display = flagWar ? "inline-block" : "none";
			el.msg.innerHTML = message;
			const playing = Boolean(autoId);
			el.btnRound.disabled = gameOver || playing;
			el.auto.disabled = gameOver;
			el.speed.disabled = !playing || gameOver;
		}

		// --- Core game logic ---
		function startGame() {
			const deck = shuffle(buildDeck());
			p1.deck = deck.slice(0, 26);
			p2.deck = deck.slice(26);
			pile = [];
			lastP1 = lastP2 = null;
			rounds = 0;
			gameOver = false;
			stopAuto();
			updateUI({ message: "New game. Click Play round or enable Auto-play." });
		}

		function draw(player) {
			return player.deck.shift() || null;
		}
		function collect(winner) {
			// Shuffle pile before collecting to reduce cycles
			shuffle(pile);
			winner.deck.push(...pile);
			pile = [];
		}
		function endGame(msg) {
			gameOver = true;
			stopAuto();
			updateUI({ message: msg });
		}

		function playRound() {
			if (gameOver) return;

			// If anyone is out of cards, finish
			if (p1.deck.length === 0) return endGame('<span class="lose">Player 1 has no cards. CPU wins!</span>');
			if (p2.deck.length === 0) return endGame('<span class="win">CPU has no cards. Player 1 wins!</span>');

			let message = "";
			let flagWar = false;

			// Flip face-up cards
			lastP1 = draw(p1);
			lastP2 = draw(p2);
			pile.push(lastP1, lastP2);

			const diff = lastP1.value - lastP2.value;
			if (diff > 0) {
				collect(p1);
				rounds++;
				message = `Player 1 wins the battle (${cardLabel(lastP1)} vs ${cardLabel(lastP2)}).`;
			} else if (diff < 0) {
				collect(p2);
				rounds++;
				message = `CPU wins the battle (${cardLabel(lastP1)} vs ${cardLabel(lastP2)}).`;
			} else {
				// War sequence
				flagWar = true;
				const warResult = resolveWar();
				if (warResult === "p1") {
					collect(p1);
					rounds++;
					message = `<span class="warn">WAR!</span> Player 1 wins the war with ${cardLabel(lastP1)} vs ${cardLabel(lastP2)}.`;
				} else if (warResult === "p2") {
					collect(p2);
					rounds++;
					message = `<span class="warn">WAR!</span> CPU wins the war with ${cardLabel(lastP1)} vs ${cardLabel(lastP2)}.`;
				} else if (warResult === "p1-game") {
					return endGame('<span class="win">CPU cannot continue war. Player 1 wins the game!</span>');
				} else if (warResult === "p2-game") {
					return endGame('<span class="lose">Player 1 cannot continue war. CPU wins the game!</span>');
				} else {
					// Should not happen, safety
					return endGame('<span class="lose">Game ended due to invalid state.</span>');
				}
			}
			updateUI({ flagWar, message });
		}

		function resolveWar() {
			// Keep going until war resolves or someone can't continue
			while (true) {
				// Each player places up to 3 face-down cards, but must keep at least 1 for the face-up if possible
				const canP1FaceUp = p1.deck.length > 0;
				const canP2FaceUp = p2.deck.length > 0;

				// If either cannot place a face-up card, the other wins the game
				if (!canP1FaceUp && canP2FaceUp) return "p2-game";
				if (!canP2FaceUp && canP1FaceUp) return "p1-game";
				if (!canP1FaceUp && !canP2FaceUp) return p1.deck.length === p2.deck.length ? "p2-game" : (p1.deck.length > p2.deck.length ? "p1-game" : "p2-game");

				placeFaceDown(p1, 3);
				placeFaceDown(p2, 3);

				// Now flip the next face-up
				lastP1 = draw(p1);
				lastP2 = draw(p2);
				// If someone still can't flip now, they lose the game
				if (!lastP1 && lastP2) return "p2-game";
				if (!lastP2 && lastP1) return "p1-game";
				if (!lastP1 && !lastP2) return "p2-game"; // arbitrary but consistent

				pile.push(lastP1, lastP2);

				const diff = lastP1.value - lastP2.value;
				if (diff > 0) return "p1";
				if (diff < 0) return "p2";
				// else: tie again, loop to continue war
			}
		}

		function placeFaceDown(player, count) {
			// Place up to `count` face-down while leaving at least one for a face-up if possible.
			let placed = 0;
			while (placed < count && player.deck.length > 1) {
				pile.push(draw(player));
				placed++;
			}
			return placed;
		}

		function cardLabel(c) { return `${c.rank}${c.suit}`; }

		// --- Controls ---
		function startAuto() {
			const delay = Number(el.speed.value);
			if (autoId) clearInterval(autoId);
			autoId = setInterval(() => {
				playRound();
				if (gameOver) stopAuto();
			}, delay);
			el.speedLabel.textContent = `${delay}ms`;
			updateUI();
		}
		function stopAuto() {
			if (autoId) clearInterval(autoId);
			autoId = null;
			updateUI();
		}

		el.btnRound.addEventListener("click", playRound);
		el.btnRestart.addEventListener("click", startGame);
		el.auto.addEventListener("change", (e) => e.target.checked ? startAuto() : stopAuto());
		el.speed.addEventListener("input", (e) => {
			el.speedLabel.textContent = `${e.target.value}ms`;
			if (autoId) startAuto();
		});
		window.addEventListener("keydown", (e) => {
			if (gameOver) return;
			if (e.code === "Space") { e.preventDefault(); if (!autoId) playRound(); }
			if (e.key.toLowerCase() === "a") { el.auto.checked = !el.auto.checked; el.auto.dispatchEvent(new Event("change")); }
		});

		// Init
		startGame();
	</script>
</body>
</html>
