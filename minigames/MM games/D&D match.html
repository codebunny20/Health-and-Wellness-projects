<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1" />
	<title>Fantasy Match — D&amp;D Lore</title>
	<style>
		:root {
			--bg: #0f0f14;
			--panel: #171822;
			--accent: #8f5cff;
			--accent-2: #4dd0e1;
			--text: #e6e6f0;
			--sub: #a9acc7;
			--ok: #2ec27e;
			--bad: #ff6b6b;
			--border: #2a2c3a;
		}
		* { box-sizing: border-box; }
		body {
			margin: 0;
			background: radial-gradient(1200px 600px at 20% -10%, rgba(143,92,255,.15), transparent),
			            radial-gradient(900px 500px at 120% 10%, rgba(77,208,225,.10), transparent),
			            var(--bg);
			color: var(--text);
			font-family: system-ui, Segoe UI, Roboto, Ubuntu, Cantarell, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
			line-height: 1.35;
		}
		header {
			padding: 20px 16px 8px;
			text-align: center;
		}
		h1 {
			margin: 0;
			font-size: 22px;
			font-weight: 700;
			letter-spacing: .3px;
		}
		.sub {
			color: var(--sub);
			font-size: 13px;
			margin-top: 4px;
		}
		.container {
			max-width: 980px;
			margin: 0 auto;
			padding: 12px 16px 32px;
		}
		.controls {
			display: grid;
			grid-template-columns: 1fr auto auto auto;
			gap: 12px;
			align-items: center;
			background: var(--panel);
			border: 1px solid var(--border);
			border-radius: 10px;
			padding: 10px;
		}
		@media (max-width: 720px) {
			.controls { grid-template-columns: 1fr 1fr 1fr; }
			.controls .wide { grid-column: 1 / -1; }
		}
		select, button {
			background: #11121a;
			color: var(--text);
			border: 1px solid var(--border);
			border-radius: 8px;
			padding: 10px 12px;
			font-size: 14px;
			cursor: pointer;
		}
		button {
			background: linear-gradient(180deg, #1a1b26, #12131b);
		}
		button.primary { border-color: color-mix(in oklab, var(--accent) 50%, var(--border)); color: #eae4ff; }
		button:hover { filter: brightness(1.05); }
		button:disabled { opacity: .6; cursor: not-allowed; }
		.stats {
			font-size: 13px;
			color: var(--sub);
			text-align: right;
		}
		.board {
			display: grid;
			grid-template-columns: 1fr 1fr;
			gap: 14px;
			margin-top: 16px;
		}
		@media (max-width: 720px) {
			.board { grid-template-columns: 1fr; }
		}
		.col {
			background: var(--panel);
			border: 1px solid var(--border);
			border-radius: 10px;
			padding: 12px;
			min-height: 280px;
		}
		.col h2 {
			margin: 0 0 8px 0;
			font-size: 15px;
			color: var(--sub);
			font-weight: 600;
			letter-spacing: .2px;
		}
		.list {
			list-style: none;
			margin: 0;
			padding: 0;
			display: grid;
			gap: 8px;
		}
		.item {
			display: flex;
			align-items: center;
			justify-content: space-between;
			gap: 8px;
			border: 1px solid var(--border);
			background: #12131b;
			border-radius: 8px;
			padding: 10px 12px;
			min-height: 44px;
			user-select: none;
		}
		.item.left { cursor: grab; }
		.item.left.dragging { opacity: .6; }
		.tag {
			font-size: 12px;
			color: var(--sub);
			opacity: .9;
		}
		.drop {
			outline: 2px dashed transparent;
			transition: outline-color .15s ease;
		}
		.drop.active { outline-color: color-mix(in oklab, var(--accent-2) 70%, transparent); }
		.pill {
			margin-left: auto;
			background: rgba(143,92,255,.12);
			border: 1px solid rgba(143,92,255,.35);
			color: #eae4ff;
			font-size: 12px;
			padding: 3px 8px;
			border-radius: 999px;
		}
		.assign {
			margin-left: auto;
			display: inline-flex;
			align-items: center;
			gap: 6px;
			background: rgba(77,208,225,.12);
			border: 1px solid rgba(77,208,225,.35);
			color: #d9fbff;
			font-size: 12px;
			padding: 4px 8px;
			border-radius: 999px;
		}
		.assign button {
			all: unset;
			display: inline-flex;
			align-items: center;
			justify-content: center;
			width: 16px; height: 16px;
			border-radius: 50%;
			background: rgba(0,0,0,.25);
			border: 1px solid rgba(255,255,255,.22);
			cursor: pointer;
			font-size: 12px;
			line-height: 1;
		}
		.right.correct { border-color: rgba(46,194,126,.6); box-shadow: inset 0 0 0 1px rgba(46,194,126,.35); }
		.right.wrong   { border-color: rgba(255,107,107,.6); box-shadow: inset 0 0 0 1px rgba(255,107,107,.35); }
		.footer {
			margin-top: 12px;
			color: var(--sub);
			font-size: 12px;
			text-align: center;
		}
	</style>
</head>
<body>
	<header>
		<h1>Fantasy Match</h1>
		<div class="sub">Match D&amp;D-style lore: ingredients to effects, monsters to traits, and quest items to purposes.</div>
	</header>

	<div class="container">
		<div class="controls">
			<select id="category" class="wide" aria-label="Category">
				<option value="potions">Potion Ingredient Match</option>
				<option value="monsters">Monster Trait Match</option>
				<option value="quests">Quest Item Match</option>
			</select>
			<button id="shuffle" title="Shuffle">Shuffle</button>
			<button id="reset" title="Reset">Reset</button>
			<button id="check" class="primary" title="Check">Check</button>
			<div class="stats wide" id="stats">Matches: 0/0</div>
		</div>

		<div class="board" id="board" aria-live="polite">
			<div class="col">
				<h2>Left — Drag these</h2>
				<ul id="leftList" class="list" aria-label="Terms to drag"></ul>
			</div>
			<div class="col">
				<h2>Right — Drop here</h2>
				<ul id="rightList" class="list" aria-label="Targets to match"></ul>
			</div>
		</div>

		<div class="footer">Tip: Drag a left item onto a right item. Click × to unassign. Use Check to validate.</div>
	</div>

	<script>
		const DATA = {
			potions: [
				{ left: "Mandrake Root", right: "Sleep Spell" },
				{ left: "Phoenix Feather", right: "Revive Ally" },
				{ left: "Nightshade", right: "Poison Brew" },
				{ left: "Dragon’s Blood", right: "Strength Elixir" },
				{ left: "Moondew", right: "Invisibility Draught" }
			],
			monsters: [
				{ left: "Vampire", right: "Weak to Sunlight" },
				{ left: "Troll", right: "Regenerates (burn to stop)" },
				{ left: "Basilisk", right: "Petrifying Gaze" },
				{ left: "Werewolf", right: "Silver Vulnerability" },
				{ left: "Ghost", right: "Ethereal—needs Magic Weapon" }
			],
			quests: [
				{ left: "Ancient Key", right: "Unlock Temple Door" },
				{ left: "Map Fragment", right: "Reveal Hidden Path" },
				{ left: "Sacred Relic", right: "Calm the Storm" },
				{ left: "Dragon Sigil", right: "Open the Dragon Gate" },
				{ left: "Cursed Coin", right: "Triggers Greed Trap" }
			]
		};

		const els = {
			category: document.getElementById('category'),
			leftList: document.getElementById('leftList'),
			rightList: document.getElementById('rightList'),
			shuffle: document.getElementById('shuffle'),
			reset: document.getElementById('reset'),
			check: document.getElementById('check'),
			stats: document.getElementById('stats'),
			board: document.getElementById('board')
		};

		const state = {
			category: 'potions',
			pairs: [],
			leftOrder: [],
			rightOrder: [],
			matches: new Map(),     // rightId -> leftId
			expect: new Map(),      // leftText -> rightText
			ids: { left: new Map(), right: new Map() } // id -> text
		};

		function shuffleArray(a) {
			const arr = a.slice();
			for (let i = arr.length - 1; i > 0; i--) {
				const j = Math.floor(Math.random() * (i + 1));
				[arr[i], arr[j]] = [arr[j], arr[i]];
			}
			return arr;
		}

		function normalize(s) {
			return String(s).toLowerCase().replace(/\s+/g, ' ').trim();
		}

		function loadCategory(cat) {
			state.category = cat;
			state.pairs = (DATA[cat] || []).map((p, i) => ({...p, i}));
			state.leftOrder = shuffleArray(state.pairs.map(p => p.i));
			state.rightOrder = shuffleArray(state.pairs.map(p => p.i));
			state.matches.clear();
			state.expect.clear();
			state.ids.left.clear();
			state.ids.right.clear();
			for (const p of state.pairs) state.expect.set(normalize(p.left), normalize(p.right));
			render();
		}

		function render() {
			els.leftList.innerHTML = '';
			els.rightList.innerHTML = '';
			// Render left (draggable)
			for (const idx of state.leftOrder) {
				const p = state.pairs.find(x => x.i === idx);
				const id = `L-${p.i}`;
				state.ids.left.set(id, p.left);
				const li = document.createElement('li');
				li.className = 'item left';
				li.draggable = true;
				li.id = id;
				li.setAttribute('role', 'button');
				li.setAttribute('aria-grabbed', 'false');
				li.innerHTML = `<span>${p.left}</span><span class="tag">drag</span>`;
				li.addEventListener('dragstart', e => {
					li.classList.add('dragging');
					li.setAttribute('aria-grabbed', 'true');
					e.dataTransfer.setData('text/plain', id);
				});
				li.addEventListener('dragend', () => {
					li.classList.remove('dragging');
					li.setAttribute('aria-grabbed', 'false');
				});
				els.leftList.appendChild(li);
			}
			// Render right (drop targets)
			for (const idx of state.rightOrder) {
				const p = state.pairs.find(x => x.i === idx);
				const id = `R-${p.i}`;
				state.ids.right.set(id, p.right);
				const li = document.createElement('li');
				li.className = 'item right drop';
				li.id = id;
				li.dataset.rightId = id;
				li.innerHTML = `<span>${p.right}</span><span class="pill">drop here</span>`;
				li.addEventListener('dragover', e => { e.preventDefault(); li.classList.add('active'); });
				li.addEventListener('dragleave', () => li.classList.remove('active'));
				li.addEventListener('drop', e => {
					e.preventDefault();
					li.classList.remove('active');
					const leftId = e.dataTransfer.getData('text/plain');
					if (!state.ids.left.has(leftId)) return;
					assign(leftId, id);
				});
				els.rightList.appendChild(li);
			}
			updateStats();
		}

		function unassignByLeft(leftId) {
			for (const [rId, lId] of state.matches.entries()) {
				if (lId === leftId) {
					state.matches.delete(rId);
					const node = document.getElementById(rId);
					if (node) resetRightNode(node);
				}
			}
		}

		function resetRightNode(node) {
			node.classList.remove('correct', 'wrong');
			node.innerHTML = `<span>${state.ids.right.get(node.id)}</span><span class="pill">drop here</span>`;
		}

		function assign(leftId, rightId) {
			// Remove any previous assignments
			unassignByLeft(leftId);
			if (state.matches.has(rightId)) {
				// Clear existing assignment on this right
				state.matches.delete(rightId);
			}
			state.matches.set(rightId, leftId);
			// Update UI for this right
			const rightNode = document.getElementById(rightId);
			const leftLabel = state.ids.left.get(leftId);
			if (rightNode) {
				rightNode.classList.remove('correct', 'wrong');
				rightNode.innerHTML = `
					<span>${state.ids.right.get(rightId)}</span>
					<span class="assign" title="Assigned: ${leftLabel}">
						${leftLabel}
						<button aria-label="Unassign" onclick="(function(rid){ window.__unassign(rid); })('${rightId}')">×</button>
					</span>
				`;
			}
			updateStats();
		}

		window.__unassign = function(rightId) {
			state.matches.delete(rightId);
			const node = document.getElementById(rightId);
			if (node) resetRightNode(node);
			updateStats();
		};

		function check() {
			let correct = 0;
			for (const [rightId, leftId] of state.matches.entries()) {
				const rightText = normalize(state.ids.right.get(rightId));
				const leftText = normalize(state.ids.left.get(leftId));
				const expectedRight = state.expect.get(leftText);
				const ok = expectedRight && expectedRight === rightText;
				const node = document.getElementById(rightId);
				if (node) {
					node.classList.toggle('correct', !!ok);
					node.classList.toggle('wrong', !ok);
				}
				if (ok) correct++;
			}
			const total = state.pairs.length;
			els.stats.textContent = `Matches: ${state.matches.size}/${total} — Correct: ${correct}/${total}`;
		}

		function resetAll() {
			state.matches.clear();
			render();
			els.stats.textContent = `Matches: 0/${state.pairs.length}`;
		}

		function shuffleAll() {
			state.leftOrder = shuffleArray(state.pairs.map(p => p.i));
			state.rightOrder = shuffleArray(state.pairs.map(p => p.i));
			state.matches.clear();
			render();
		}

		function updateStats() {
			els.stats.textContent = `Matches: ${state.matches.size}/${state.pairs.length}`;
		}

		// Wire up
		els.category.addEventListener('change', e => loadCategory(e.target.value));
		els.reset.addEventListener('click', resetAll);
		els.shuffle.addEventListener('click', shuffleAll);
		els.check.addEventListener('click', check);

		// Init
		loadCategory(els.category.value);
	</script>
</body>
</html>
